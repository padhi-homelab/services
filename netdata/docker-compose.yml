version: '2.4'

networks:
  shared:
    external: true
  proxy:
    external: true

volumes:
  netdata_lib:
    driver_opts:
      type: tmpfs
      device: tmpfs
  netdata_cache:
    driver_opts:
      type: tmpfs
      device: tmpfs

services:
  netdata:
    hostname: ${HOST_NAME:?}
    image: padhihomelab/netdata:1.36.0
    restart: unless-stopped

    cap_add:
    - SYS_PTRACE
    security_opt:
    - apparmor:unconfined
    - no-new-privileges:true

    networks:
    - shared
    - proxy
    volumes:
    - netdata_cache:/var/cache/netdata:rw
    - ./config/netdata/etc/netdata/charts.d.conf:/etc/netdata/charts.d.conf:ro
    - ./config/netdata/etc/netdata/netdata.conf:/etc/netdata/netdata.conf:ro
    - /etc/group:/host/etc/group:ro
    - /etc/os-release:/host/etc/os-release:ro
    - /etc/passwd:/host/etc/passwd:ro
    - /proc:/host/proc:ro
    - /sys:/host/sys:ro

    environment:
      DO_NOT_TRACK: '1'
      DOCKER_HOST: docker.sock-proxy:1279
      TZ: ${TZ:?}    

    logging:
      options:
        max-size: "8m"
        max-file: "2"
